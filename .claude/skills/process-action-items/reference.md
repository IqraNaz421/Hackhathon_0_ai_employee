# Process Action Items â€“ Reference Guide

This reference document supports the `process-action-items` Skill for the Personal AI Employee hackathon (Bronze tier).

It standardizes **how Claude Code processes action items** discovered by watchers, creates plans, and maintains the system dashboard in an Obsidian vault.

---

## 1. Scope of This Reference

This file focuses on the **action item processing layer**:

- How to read and parse action item files from `/Needs_Action/`
- How to analyze content using `Company_Handbook.md` rules
- How to generate structured `Plan.md` files
- How to update `Dashboard.md` without losing user customizations
- How to handle edge cases and errors gracefully

This reference assumes you are working within an Obsidian vault structure and following the Bronze tier constraints (read-only operations within vault).

---

## 2. File Format Standards

### 2.1 Action Item Files (`/Needs_Action/*.md`)

Action items follow a standardized frontmatter + content structure:

```markdown
---
type: email|file_drop|manual
from: sender@example.com | /path/to/file | user
subject: Email Subject | File Name | Manual Entry
received: 2026-01-09T10:30:00Z
priority: high|medium|low|auto
status: pending
source_id: EMAIL_12345 | FILE_abc123 | MANUAL_001
---

## Content
[The actual actionable content]

## Metadata
[Additional context from watcher]
```

**Required Fields**:
- `type`: Must be one of `email`, `file_drop`, or `manual`
- `received`: ISO 8601 timestamp
- `status`: Always `pending` for new items

**Optional Fields**:
- `from`: Sender email, file path, or user identifier
- `subject`: Email subject, filename, or brief title
- `priority`: Auto-detected or user-specified
- `source_id`: Unique identifier from watcher

### 2.2 Plan Files (`/Plans/PLAN_*.md`)

Generated plans must follow this structure:

```markdown
---
type: action_plan
source: EMAIL|FILE|MANUAL
created: 2026-01-09T11:00:00Z
priority: HIGH|MEDIUM|LOW
status: pending|in_progress|completed
original_file: Needs_Action/EMAIL_12345.md
---

# Action Plan: [Brief Descriptive Title]

## Source Information
- **Type**: [email|file_drop|manual]
- **From**: [sender/path/user]
- **Received**: [ISO timestamp]
- **Original Item**: `/Needs_Action/[filename].md`

## Analysis
[2-3 sentence analysis of what this action item represents and why it matters]

## Recommended Actions
- [ ] Action 1: [Specific, actionable description]
- [ ] Action 2: [Specific, actionable description]
- [ ] Action 3: [Specific, actionable description]

## Context
[Additional context from Company_Handbook.md or related files]

## Notes
[Implementation notes, edge cases, or considerations]

## Next Steps
[What should happen next - manual review, scheduled check, etc.]
```

**Required Frontmatter**:
- `type`: Always `action_plan`
- `source`: Original action item type
- `created`: ISO 8601 timestamp of plan creation
- `priority`: Extracted or inferred priority
- `status`: Initial status is `pending`
- `original_file`: Path to source action item

### 2.3 Dashboard.md Structure

The dashboard should maintain this structure while allowing user customizations:

```markdown
# Personal AI Employee Dashboard

**Last Updated**: [ISO_TIMESTAMP]

## Status Overview
- **Pending Action Items**: [count from /Needs_Action/]
- **Active Plans**: [count from /Plans/ with status pending|in_progress]
- **Completed Today**: [count of items moved to /Done/ today]
- **Last Processed**: [ISO timestamp of last processing run]

## Recent Activity
[Chronological list of recent actions - last 5-10 items]
- `[TIMESTAMP]` Processed: [brief description]
- `[TIMESTAMP]` Created Plan: [plan title]
- `[TIMESTAMP]` Archived: [action item summary]

## System Health
- **Watchers**: [Status - running|stopped|error]
- **Vault Access**: [Status - accessible|error]
- **Last Check**: [ISO timestamp]

## Active Plans Summary
[Brief list of top priority pending plans]
1. [Priority] [Plan Title] - [Brief status]
2. [Priority] [Plan Title] - [Brief status]

---
*Auto-generated by Process Action Items Skill. User customizations below are preserved.*
```

**Update Rules**:
- Always preserve content below the `---` separator
- Update counters dynamically (don't hardcode)
- Append to Recent Activity (limit to last 10 items)
- Never delete user-added sections

### 2.4 Company_Handbook.md Expected Structure

The handbook should contain:

```markdown
# Company Handbook

## Processing Rules

### Email Processing
[Rules for handling emails - priority, response templates, etc.]

### File Processing
[Rules for handling file drops - types, destinations, etc.]

### Priority Classification
- **HIGH**: [Keywords, senders, patterns]
- **MEDIUM**: [Keywords, senders, patterns]
- **LOW**: [Keywords, senders, patterns]

## Response Templates
[Templates for common responses]

## Contact Information
[Important contacts, aliases, etc.]
```

If `Company_Handbook.md` is missing, use default rules:
- Priority HIGH: Keywords "urgent", "asap", "important", "deadline"
- Priority MEDIUM: Business hours emails, standard requests
- Priority LOW: Newsletters, automated messages, low-priority files

---

## 3. Processing Logic

### 3.1 Detection Algorithm

```pseudocode
FOR each file in /Needs_Action/:
    IF file is .md AND status == "pending":
        Read file content
        Extract frontmatter
        Check for duplicate (compare content hash or source_id)
        IF not duplicate:
            Process action item
        ELSE:
            Log duplicate, skip
```

### 3.2 Analysis Algorithm

```pseudocode
Read action_item.md
Read Company_Handbook.md (if exists)

Extract:
    - Action type (from frontmatter)
    - Content keywords
    - Priority indicators
    - Required information

Determine priority:
    IF Company_Handbook.md exists:
        Use handbook rules
    ELSE:
        Use default keyword-based rules

Classify action:
    - Response needed?
    - Information extraction needed?
    - File processing needed?
    - Manual review needed?

Generate plan steps based on classification
```

### 3.3 Plan Generation Algorithm

```pseudocode
Create Plan.md with frontmatter:
    - type: action_plan
    - source: [action_item.type]
    - created: [current_timestamp]
    - priority: [determined_priority]
    - status: pending
    - original_file: [action_item.path]

Write analysis section:
    - Brief summary of action item
    - Why it matters
    - What needs to happen

Write recommended actions:
    - Convert analysis into actionable checkboxes
    - Each action should be specific and measurable
    - Order by priority/logical sequence

Write context section:
    - Reference relevant Company_Handbook rules
    - Include related information
    - Add warnings if needed

Write next steps:
    - What happens after plan is created
    - Who should review (if applicable)
    - Follow-up requirements
```

### 3.4 Dashboard Update Algorithm

```pseudocode
Read current Dashboard.md
Preserve content below separator (if exists)

Update Status Overview:
    - Count files in /Needs_Action/
    - Count plans with status pending|in_progress
    - Count files in /Done/ modified today
    - Update Last Processed timestamp

Update Recent Activity:
    - Prepend new activity entry
    - Limit to last 10 entries
    - Format: [TIMESTAMP] [Action]: [Description]

Update System Health:
    - Check watcher status (if detectable)
    - Check vault accessibility
    - Update Last Check timestamp

Update Active Plans Summary:
    - List top 3-5 pending plans by priority
    - Format: [Priority] [Title] - [Status]

Write updated Dashboard.md
```

---

## 4. Error Handling Patterns

### 4.1 Missing Files

**Scenario**: `Company_Handbook.md` doesn't exist
**Response**: 
- Log warning
- Use default priority rules
- Continue processing
- Add note in plan: "Company_Handbook.md not found, used default rules"

### 4.2 Malformed Frontmatter

**Scenario**: Action item has invalid YAML frontmatter
**Response**:
- Log error with filename
- Skip processing (don't crash)
- Create error entry in Dashboard: "Failed to process [filename]: Invalid frontmatter"
- Don't move file (leave in `/Needs_Action/` for manual review)

### 4.3 Permission Errors

**Scenario**: Cannot write to `/Plans/` or update `Dashboard.md`
**Response**:
- Log critical error
- Stop processing remaining items
- Update Dashboard if possible (even if partial)
- Alert user: "Vault permission error. Check file permissions."

### 4.4 Duplicate Detection

**Scenario**: Same action item already processed
**Response**:
- Compare `source_id` or content hash
- Skip duplicate
- Log: "Skipped duplicate: [source_id]"
- Optional: Add note to existing plan if found

### 4.5 Empty Content

**Scenario**: Action item has no content section
**Response**:
- Process anyway (frontmatter may have enough info)
- Create plan with note: "Empty content, processing based on metadata only"
- Flag for manual review in plan notes

---

## 5. Performance Considerations

### 5.1 Batch Processing

For Bronze tier, process items sequentially:
- Read all files in `/Needs_Action/`
- Process one at a time
- Update Dashboard after each batch (not after each item)

### 5.2 File Operations

- Use atomic writes when possible (write to temp, then rename)
- Don't lock files (read-only access to action items)
- Preserve file timestamps when moving to `/Done/`

### 5.3 Memory Usage

- Process one action item at a time
- Don't load all files into memory
- Close file handles immediately after use

---

## 6. Testing Checklist

Before considering this skill production-ready:

- [ ] Processes email action items correctly
- [ ] Processes file_drop action items correctly
- [ ] Processes manual action items correctly
- [ ] Handles missing Company_Handbook.md gracefully
- [ ] Handles malformed frontmatter gracefully
- [ ] Detects and skips duplicates
- [ ] Creates valid Plan.md files
- [ ] Updates Dashboard.md without losing user content
- [ ] Moves processed files to /Done/ correctly
- [ ] Preserves file metadata when moving
- [ ] Handles permission errors gracefully
- [ ] Updates counters accurately
- [ ] Limits Recent Activity to last 10 items

---

## 7. Silver Tier: External Action Detection and Approval Requests

### 7.1 External Action Detection

When processing action items or creating plans, detect if the plan requires **external actions** that must go through the approval workflow.

**External Action Keywords** (scan plan content and recommendations):

| Action Type | Detection Keywords |
|-------------|-------------------|
| `email_send` | "send email", "reply to", "email back", "respond via email", "forward to" |
| `linkedin_post` | "post to linkedin", "share on linkedin", "linkedin update", "publish to linkedin" |
| `browser_action` | "automate browser", "fill form", "click button", "navigate to", "browser automation", "web automation" |

**Detection Algorithm**:

```pseudocode
FOR each recommended action in plan:
    content_lower = action_text.lower()

    IF any keyword in EMAIL_KEYWORDS matches content_lower:
        external_action_type = 'email_send'
        BREAK

    IF any keyword in LINKEDIN_KEYWORDS matches content_lower:
        external_action_type = 'linkedin_post'
        BREAK

    IF any keyword in BROWSER_KEYWORDS matches content_lower:
        external_action_type = 'browser_action'
        BREAK

IF external_action_type detected:
    Create approval request (see 7.2)
    DO NOT execute directly
```

### 7.2 Risk Level Assessment

Determine risk level for approval requests based on content and target:

| Risk Level | Criteria |
|------------|----------|
| `low` | Email <100 words to known contacts (from Company_Handbook.md); LinkedIn posts <200 chars without links |
| `medium` | Standard emails; LinkedIn posts 200-500 chars; Posts with links |
| `high` | Browser automation; Emails to unknown recipients; Posts >500 chars; Actions with attachments |

**Risk Assessment Algorithm**:

```pseudocode
FUNCTION assess_risk(action_type, target, content, parameters):
    # Check Company_Handbook.md for known contacts
    known_contacts = load_known_contacts_from_handbook()

    IF action_type == 'browser_action':
        RETURN 'high'  # Always high for browser automation

    IF action_type == 'email_send':
        IF target NOT IN known_contacts:
            RETURN 'high'  # Unknown recipient
        IF len(content) > 100:
            RETURN 'medium'
        IF parameters.get('attachments'):
            RETURN 'high'
        RETURN 'low'

    IF action_type == 'linkedin_post':
        text = parameters.get('text', '')
        IF len(text) > 500:
            RETURN 'high'
        IF len(text) > 200 OR 'http' in text.lower():
            RETURN 'medium'
        RETURN 'low'

    RETURN 'medium'  # Default for unknown types
```

### 7.3 Approval Request Creation

When external action is detected, create approval request in `/Pending_Approval/`:

**Filename Format**: `APPROVAL_{action_type}_{timestamp}.md`

**Required Fields**:
- `type: approval_request`
- `id`: UUID v4
- `action_type`: email_send | linkedin_post | browser_action
- `target`: Recipient/URL/account
- `risk_level`: low | medium | high
- `mcp_server`: email_mcp | linkedin_mcp | playwright_mcp
- `mcp_tool`: send_email | create_post | browser_action
- `created_timestamp`: ISO 8601
- `status`: pending
- `source_action_item`: Path to original action item

**Creation Steps**:

1. Generate unique ID (UUID v4)
2. Assess risk level using algorithm above
3. Determine MCP server and tool based on action type
4. Extract parameters from plan (to, subject, body, etc.)
5. Generate approval request markdown
6. Write to `/Pending_Approval/`
7. Log approval creation to audit log
8. Update plan status to `pending_approval`
9. Reference approval request in plan

### 7.4 Auto-Approval Threshold Checking

Before creating approval request, check if action qualifies for auto-approval:

**Auto-Approval Conditions** (from Company_Handbook.md):
- `auto_approval_enabled: true` in configuration
- Action meets low-risk criteria
- Target is in approved contacts list
- Content length below threshold

**Auto-Approval Algorithm**:

```pseudocode
FUNCTION check_auto_approval(action_type, risk_level, target, config):
    IF NOT config.auto_approval_enabled:
        RETURN False

    IF risk_level != 'low':
        RETURN False

    # Read auto-approval rules from Company_Handbook.md
    auto_rules = load_auto_approval_rules()

    IF action_type == 'email_send':
        IF target IN auto_rules.approved_email_contacts:
            RETURN True

    IF action_type == 'linkedin_post':
        IF auto_rules.auto_approve_linkedin_low_risk:
            RETURN True

    RETURN False

IF check_auto_approval():
    # Create approval request with auto_approved status
    approval.status = 'auto_approved'
    approval.approver = 'system'
    approval.approval_timestamp = now()
    # Move directly to /Approved/ folder
    MOVE approval_file TO /Approved/
```

### 7.5 Risk Factors Documentation

Include specific risk factors in approval request for human review:

**Common Risk Factors**:
- "Unknown recipient not in approved contacts list"
- "Email contains sensitive keywords"
- "Post exceeds standard character limit"
- "Browser automation requires human verification"
- "Contains external links"
- "Attachment included"
- "First-time interaction with this contact"
- "After-hours action"

---

By following this reference, the `process-action-items` Skill generates **consistent, reliable, and maintainable** action item processing that forms the foundation for autonomous Personal AI Employee operation.

# Data Model: Bronze Tier Personal AI Employee

**Feature Branch**: `001-bronze-ai-employee`
**Date**: 2026-01-09

## Overview

All data is stored as Markdown files in the Obsidian vault. This document defines the structure and format of each file type.

## Entities

### 1. Action Item (`/Needs_Action/*.md`)

An action item represents a detected item requiring attention from the watcher.

**Filename Pattern**: `action-{source}-{slug}-{timestamp}.md`
- Example: `action-gmail-meeting-request-20260109-143022.md`
- Example: `action-file-quarterly-report-20260109-150000.md`

**Frontmatter Schema**:
```yaml
---
id: string              # Unique identifier (e.g., Gmail message ID, file hash)
source: gmail | file    # Origin of the action item
title: string           # Subject line (email) or filename
created: ISO-8601       # When the item was detected
priority: high | medium | low | unknown  # If determinable
status: pending         # Always 'pending' in /Needs_Action
tags: []                # Optional categorization
---
```

**Body Structure**:
```markdown
## Summary

[Brief description or snippet of the content]

## Details

**From**: [sender email or file path]
**Date**: [original date of email/file]
**Type**: [email/document/spreadsheet/etc.]

## Content

[Full or summarized content]

## Metadata

- **Detected by**: [watcher type]
- **Watcher run**: [timestamp of detection]
```

**Validation Rules**:
- `id` MUST be unique across all action items
- `created` MUST be valid ISO-8601 timestamp
- `source` MUST be one of: `gmail`, `file`
- File MUST have valid YAML frontmatter

### 2. Plan (`/Plans/*.md`)

A plan is the structured response to an action item, created by Claude Code.

**Filename Pattern**: `plan-{action-slug}-{timestamp}.md`
- Example: `plan-meeting-request-20260109-143500.md`

**Frontmatter Schema**:
```yaml
---
action_id: string       # Reference to source action item
created: ISO-8601       # When plan was created
priority: high | medium | low
due_date: ISO-8601 | null  # If applicable
status: open | in_progress | completed
tags: []
---
```

**Body Structure**:
```markdown
## Context

[Brief summary of the action item this plan addresses]

**Source**: [[Needs_Action/action-file.md]] or [[Done/action-file.md]]

## Analysis

[Claude Code's analysis of the action item based on Company_Handbook.md rules]

## Action Plan

### Immediate Actions
- [ ] [First action item]
- [ ] [Second action item]

### Follow-up Actions
- [ ] [Later action item]

### Dependencies
- [List any blockers or prerequisites]

## Notes

[Additional context or recommendations]

## Metadata

- **Generated by**: Claude Code
- **Rules applied**: [Reference to Company_Handbook.md sections used]
- **Processing time**: [timestamp]
```

**Validation Rules**:
- `action_id` MUST reference an existing action item
- At least 1 checkbox item MUST be present in Action Plan
- `created` MUST be valid ISO-8601 timestamp

### 3. Dashboard (`/Dashboard.md`)

A live status summary of the system state, updated by the watcher and Claude Code.

**Frontmatter Schema**:
```yaml
---
last_updated: ISO-8601
watcher_status: running | stopped | error
last_watcher_check: ISO-8601
---
```

**Body Structure**:
```markdown
# Personal AI Employee Dashboard

**Last Updated**: {{last_updated}}

## System Status

| Component | Status | Last Activity |
|-----------|--------|---------------|
| Watcher | {{watcher_status}} | {{last_watcher_check}} |
| Vault Access | ✅ OK | {{last_vault_access}} |

## Pending Items

**Items in /Needs_Action**: {{needs_action_count}}

| Item | Source | Priority | Age |
|------|--------|----------|-----|
{{#each needs_action_items}}
| [[{{filename}}]] | {{source}} | {{priority}} | {{age}} |
{{/each}}

## Recent Activity (Last 24h)

| Time | Action | Details |
|------|--------|---------|
{{#each recent_actions}}
| {{timestamp}} | {{action}} | {{details}} |
{{/each}}

## Quick Stats

- **Plans created today**: {{plans_today}}
- **Items processed today**: {{processed_today}}
- **Active plans**: {{active_plans}}

## Recent Errors

{{#if errors}}
| Time | Error | Resolution |
|------|-------|------------|
{{#each errors}}
| {{timestamp}} | {{message}} | {{resolution}} |
{{/each}}
{{else}}
No recent errors.
{{/if}}
```

### 4. Company Handbook (`/Company_Handbook.md`)

Configuration and rules document for the AI employee.

**Frontmatter Schema**:
```yaml
---
version: string         # e.g., "1.0.0"
last_updated: ISO-8601
---
```

**Body Structure**:
```markdown
# Company Handbook

## Watcher Configuration

### Check Interval
- Default: 60 seconds
- Environment variable: `CHECK_INTERVAL`

### Watcher Type
- Options: `gmail` or `filesystem`
- Environment variable: `WATCHER_TYPE`

## Priority Rules

### High Priority
- Subject contains: "URGENT", "ASAP", "Critical"
- From: [list of VIP contacts]

### Medium Priority
- Default for emails from known contacts
- Documents in monitored folders

### Low Priority
- Newsletters and automated emails
- Non-actionable notifications

## Processing Rules

### Email Processing
1. Extract subject, sender, date, and body snippet
2. Determine priority based on rules above
3. Create action file in /Needs_Action

### File Processing
1. Extract filename, type, creation date
2. Assign medium priority by default
3. Create action file in /Needs_Action

## Plan Generation Rules

### Required Sections
- Context: Always include source reference
- Analysis: Apply priority rules and categorization
- Action Plan: Minimum 3 actionable checkboxes

### Action Item Format
- Use imperative mood ("Review document", not "Document should be reviewed")
- Include deadline if determinable
- Group by timeline (immediate, follow-up)

## Approved Contacts

[List of email addresses that bypass certain checks - for future HITL use]

## Error Handling

### Common Errors
| Error | Resolution |
|-------|------------|
| Gmail auth expired | Re-run OAuth flow |
| Vault inaccessible | Check VAULT_PATH |
| Rate limited | Wait and retry |
```

### 5. Processed Tracker (`.processed_ids.json`)

Internal file for tracking processed items (not a user-facing Markdown file).

**Location**: `{VAULT_PATH}/.processed_ids.json`

**Schema**:
```json
{
  "gmail": ["msg_id_1", "msg_id_2"],
  "file": ["hash_1", "hash_2"]
}
```

## Folder Structure

```
vault/
├── Inbox/                    # Manual triage area (Bronze: unused)
├── Needs_Action/             # Watcher deposits action items here
│   └── action-*.md
├── Done/                     # Processed action items archived here
│   └── action-*.md
├── Plans/                    # Claude Code creates plans here
│   └── plan-*.md
├── Dashboard.md              # System status
├── Company_Handbook.md       # Configuration and rules
└── .processed_ids.json       # Duplicate prevention tracker (gitignored)
```

## State Transitions

```
                    ┌─────────────────┐
                    │ External Source │
                    │ (Gmail/Files)   │
                    └────────┬────────┘
                             │
                      Watcher detects
                             │
                             ▼
                    ┌─────────────────┐
                    │ /Needs_Action/  │
                    │  action-*.md    │
                    └────────┬────────┘
                             │
              Claude Code processes
                             │
              ┌──────────────┼──────────────┐
              │              │              │
              ▼              ▼              ▼
      ┌───────────┐  ┌───────────┐  ┌───────────┐
      │ /Plans/   │  │ /Done/    │  │ Dashboard │
      │ plan-*.md │  │ action-*  │  │ .md       │
      └───────────┘  └───────────┘  └───────────┘
```

## Relationships

```
Action Item ──creates──▶ Plan (1:1)
Action Item ──moves to──▶ Done (after processing)
Watcher ──updates──▶ Dashboard
Watcher ──writes──▶ ProcessedTracker
Company Handbook ──configures──▶ Plan Generation
```

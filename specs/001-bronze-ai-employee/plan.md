# Implementation Plan: Bronze Tier Personal AI Employee

**Branch**: `001-bronze-ai-employee` | **Date**: 2026-01-09 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-bronze-ai-employee/spec.md`

## Summary

Build a Bronze tier Personal AI Employee system that:
1. Monitors external sources (Gmail OR filesystem) via Python watchers
2. Creates action item files in an Obsidian vault (`/Needs_Action/`)
3. Uses Claude Code to analyze items and create structured plans in `/Plans/`
4. Maintains a live dashboard showing system status

Technical approach: Python 3.13+ with `watchdog` for filesystem monitoring, `google-api-python-client` for Gmail, and `python-dotenv` for configuration. All data stored as local Markdown files in Obsidian vault.

## Technical Context

**Language/Version**: Python 3.13+
**Primary Dependencies**: watchdog, google-api-python-client, google-auth-oauthlib, python-dotenv
**Storage**: Local Markdown files (Obsidian vault)
**Testing**: Manual verification (automated tests optional for Bronze tier)
**Target Platform**: Windows/macOS/Linux desktop
**Project Type**: Single project (Python scripts + Claude Code skill)
**Performance Goals**: Process items within 2 check intervals (~2 minutes)
**Constraints**: Read-only vault operations, no external actions, one watcher type
**Scale/Scope**: Single user, personal productivity

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Implementation |
|-----------|--------|----------------|
| I. Local-First Architecture | PASS | All data in Obsidian vault Markdown files |
| II. Read-Only Operations | PASS | Bronze tier: vault read/write only, no external actions |
| III. Agent Skills | PASS | `process-action-items` skill at `.claude/skills/` |
| IV. Security by Design | PASS | Credentials in `.env` (gitignored), no secrets in vault |
| V. Simple Watcher Execution | PASS | Manual/cron execution, basic error handling |
| VI. Basic Testing | PASS | Manual verification acceptable |
| VII. Basic Dashboard | PASS | `Dashboard.md` with status counts |
| VIII. Modular Watcher | PASS | BaseWatcher pattern with subclasses |

**Gate Status**: ALL PASS - Proceed with implementation.

## Project Structure

### Documentation (this feature)

```text
specs/001-bronze-ai-employee/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Technology research
├── data-model.md        # Entity schemas
├── quickstart.md        # Setup guide
├── checklists/          # Quality checklists
│   └── requirements.md
└── tasks.md             # Generated by /sp.tasks
```

### Source Code (repository root)

```text
src/
├── watchers/
│   ├── __init__.py
│   ├── base_watcher.py      # BaseWatcher abstract class
│   ├── filesystem_watcher.py # Filesystem monitoring
│   └── gmail_watcher.py      # Gmail API polling
├── models/
│   ├── __init__.py
│   ├── action_item.py        # Action item creation
│   └── processed_tracker.py  # Duplicate prevention
├── utils/
│   ├── __init__.py
│   ├── config.py             # Environment config loader
│   └── dashboard.py          # Dashboard updater
└── main.py                   # Entry point

vault/                        # Obsidian vault (sample/development)
├── Inbox/
├── Needs_Action/
├── Done/
├── Plans/
├── Dashboard.md
└── Company_Handbook.md

.claude/
└── skills/
    └── process-action-items/
        ├── SKILL.md          # Skill documentation
        └── prompt.md         # Prompt template

.env.example                  # Environment template
requirements.txt              # Python dependencies
```

**Structure Decision**: Single project structure. Python scripts in `src/` with modular organization. Vault can be any user's Obsidian vault (path configured via `VAULT_PATH`).

## Component Design

### C1: BaseWatcher (Abstract)

**Purpose**: Common interface for all watcher implementations.

**Pattern**: Template Method - defines `run()` loop, subclasses implement `check_for_updates()` and `create_action_file()`.

**Key Methods**:
```python
class BaseWatcher(ABC):
    def __init__(self, vault_path: Path, check_interval: int = 60)
    def run(self) -> None                    # Main loop
    @abstractmethod
    def check_for_updates(self) -> list      # Poll external source
    @abstractmethod
    def create_action_file(self, item) -> Path  # Write to vault
    def update_dashboard(self) -> None       # Update status
```

### C2: FilesystemWatcher

**Purpose**: Monitor a folder for new files using `watchdog`.

**Implementation**:
- Extends `BaseWatcher`
- Uses `watchdog.observers.Observer` with `FileSystemEventHandler`
- `on_created` event triggers action file creation
- Tracks processed files by path hash

### C3: GmailWatcher

**Purpose**: Poll Gmail API for new emails.

**Implementation**:
- Extends `BaseWatcher`
- Uses `google-api-python-client` with OAuth 2.0
- Polls `messages.list()` with INBOX label
- Tracks processed messages by Gmail message ID
- Handles token refresh automatically

### C4: ProcessedTracker

**Purpose**: Prevent duplicate processing of items.

**Implementation**:
- JSON file at `{vault}/.processed_ids.json`
- Separate sets for `gmail` and `file` sources
- Persists on every addition
- Supports manual editing for recovery

### C5: Dashboard Updater

**Purpose**: Keep `Dashboard.md` current.

**Updates**:
- Watcher status and last check time
- Count of items in `/Needs_Action/`
- Recent activity log
- Error notifications

### C6: Process-Action-Items Skill

**Purpose**: Claude Code skill to process vault items.

**Workflow**:
1. Read all `.md` files from `/Needs_Action/`
2. For each file:
   - Parse frontmatter and content
   - Load rules from `Company_Handbook.md`
   - Generate structured plan
   - Write plan to `/Plans/plan-{slug}-{timestamp}.md`
   - Move original to `/Done/`
3. Update `Dashboard.md` with activity

## Error Handling Strategy

| Error Type | Handling | Recovery |
|------------|----------|----------|
| Vault inaccessible | Log error, exit gracefully | User fixes path, restart |
| Gmail auth expired | Log error, stop watcher | User re-authenticates |
| API rate limit | Exponential backoff (1 retry) | Continue next cycle |
| Network timeout | Log, continue | Retry next cycle |
| Malformed file | Log, skip file | Manual intervention |

## Security Considerations

- **Credentials**: `.env` file gitignored, `credentials.json` and `token.pickle` gitignored
- **Vault Access**: Watcher only writes to designated folders
- **Logging**: Never log credential values
- **DRY_RUN**: Environment flag to test without writing

## Dependencies

```txt
# requirements.txt
watchdog>=4.0.0
google-api-python-client>=2.100.0
google-auth-oauthlib>=1.0.0
google-auth-httplib2>=0.1.0
python-dotenv>=1.0.0
pyyaml>=6.0.0
```

## Implementation Order

1. **Phase 1: Setup** - Project structure, dependencies, vault folders
2. **Phase 2: Foundational** - BaseWatcher, config loader, processed tracker
3. **Phase 3: User Story 1** - Filesystem OR Gmail watcher (choose one)
4. **Phase 4: User Story 2** - Process-action-items skill, plan creation
5. **Phase 5: User Story 3** - Dashboard updates
6. **Phase 6: User Story 4** - Company_Handbook.md, documentation
7. **Phase 7: Polish** - Error handling, testing, cleanup

## Complexity Tracking

> No constitution violations - all components align with Bronze tier requirements.

| Aspect | Complexity | Justification |
|--------|------------|---------------|
| Single watcher type | Low | Bronze tier only requires one |
| Manual skill invocation | Low | No real-time automation needed |
| File-based tracking | Low | Simpler than database |
| Console logging | Low | Structured JSON optional |

## Artifacts Generated

- [x] `research.md` - Technology decisions
- [x] `data-model.md` - Entity schemas
- [x] `quickstart.md` - Setup guide
- [ ] `tasks.md` - (Generated by `/sp.tasks`)

## Next Steps

Run `/sp.tasks` to generate the detailed task list for implementation.
